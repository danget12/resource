
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Exit Exam</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      display: flex;
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    .left-panel, .right-panel {
      width: 20%;
      padding: 15px;
      background-color: #f0f4f8;
      border-radius: 6px;
      display: none;
    }
    .main-panel {
      width: 60%;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    h2, h3, h4 {
      color: #003366;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-family: 'Georgia', serif;
    }
    button {
      background-color: #003366;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0055a5;
    }
    .timer {
      text-align: right;
      font-weight: bold;
      color: #aa0000;
      margin-bottom: 20px;
    }
    .question-box {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      background-color: #fdfdfd;
      border-radius: 6px;
    }
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .question-nav span {
      display: inline-block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      margin: 5px;
      border-radius: 4px;
      border: 1px solid #aaa;
      cursor: pointer;
      font-weight: bold;
      color: #003366;
    }
    .question-nav .answered {
      background-color: #cce5ff;
    }
    .question-nav .flagged {
      border: 2px solid red;
    }
    .flag-btn {
      background-color: #ffcc00;
      color: black;
      font-weight: bold;
      width: 100%;
    }
    .review, .summary {
      padding-top: 10px;
    }
    .answer-review {
      margin-top: 10px;
      padding: 10px;
      background-color: #f4f4f4;
      border-radius: 4px;
      border-left: 5px solid #003366;
    }
    .correct { color: green; font-weight: bold; }
    .incorrect { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-panel" id="leftPanel">
      <button class="flag-btn" onclick="toggleFlag()">Flag/Unflag Question</button>
    </div>
    <div class="main-panel">
      <div id="login" class="login active">
        <h2>Login</h2>
        <select id="department">
          <option value="">Select Department</option>
          <option value="CSE">CSE</option>
          <option value="Management">Management</option>
          <option value="Accounting">Accounting</option>
          <option value="Economics">Economics</option>
        </select>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <select id="questionVersion">
          <option value="">Select Question Set</option>
          <option value="v1">Version 1</option>
          <option value="v2">Version 2</option>
        </select>
        <button onclick="login()">Login</button>
      </div>
      <div id="quiz" class="quiz" style="display:none;">
        <div class="timer">Time left: <span id="time">30:00</span></div>
        <div class="question-box" id="questionBox"></div>
      </div>
      <div id="summary" class="summary" style="display:none;">
        <h2>Finish Attempt</h2>
        <div id="summaryContent"></div>
        <button onclick="backToAttempt()">Back to Attempt</button>
        <button onclick="confirmSubmit()">Submit</button>
      </div>
      <div id="review" class="review" style="display:none;">
        <h2>Score Review</h2>
        <div id="reviewContent"></div>
        <button onclick="location.reload()">Restart</button>
      </div>
      <div id="adminUpload" class="admin-upload" style="display:none;">
        <h2>Admin Panel</h2>
        <input type="file" id="fileInput"><br>
        <button onclick="uploadQuestions()">Upload Questions</button>
        <hr>
        <h3>Add Student Account</h3>
        <select id="newStudentDept">
          <option value="">Select Department</option>
          <option value="CSE">CSE</option>
          <option value="Management">Management</option>
          <option value="Accounting">Accounting</option>
          <option value="Economics">Economics</option>
        </select>
        <input type="text" id="newStudentUser" placeholder="Student Username">
        <input type="password" id="newStudentPass" placeholder="Student Password">
        <button onclick="addStudent()">Add Student</button>
      </div>
    </div>
    <div class="right-panel" id="rightPanel">
      <h4>Question Navigation</h4>
      <div id="questionNav" class="question-nav"></div>
      <button onclick="showSummary()">Finish Attempt</button>
    </div>
  </div>
<script>
let allQuestions = {
  CSE: {
    v1: [
      { q: "What is HTML?", options: ["Programming", "Markup", "Database", "Protocol"], answer: 1 },
      { q: "2+2?", options: ["3", "4", "5", "6"], answer: 1 }
    ]
  },
  Accounting: {
v1: [
    {
      "question_id": 1,
      "question": "What is the accounting equation?",
      "options": [
        "Assets = Liabilities + Equity",
        "Assets = Liabilities - Equity",
        "Assets = Revenue - Expenses",
        "Equity = Assets + Liabilities"
      ],
      "correct_answer": "Assets = Liabilities + Equity"
    },
    {
      "question_id": 2,
      "question": "Which of the following is a liability?",
      "options": [
        "Cash",
        "Accounts Receivable",
        "Accounts Payable",
        "Owner's Equity"
      ],
      "correct_answer": "Accounts Payable"
    },
    {
      "question_id": 3,
      "question": "What does GAAP stand for?",
      "options": [
        "General Agreement of Accounting Practices",
        "Generally Accepted Accounting Principles",
        "Global Accounting and Audit Practices",
        "Governmental Accounting and Auditing Practices"
      ],
      "correct_answer": "Generally Accepted Accounting Principles"
    },
    {
      "question_id": 4,
      "question": "What is the primary purpose of a balance sheet?",
      "options": [
        "To show a company’s revenue and expenses",
        "To track a company’s profits",
        "To summarize a company’s financial position at a point in time",
        "To calculate a company’s tax obligations"
      ],
      "correct_answer": "To summarize a company’s financial position at a point in time"
    },
    {
      "question_id": 5,
      "question": "What is the main purpose of a cash flow statement?",
      "options": [
        "To show how much profit a company has made",
        "To summarize income and expenses",
        "To show the inflow and outflow of cash within a company",
        "To show a company’s debt and liabilities"
      ],
      "correct_answer": "To show the inflow and outflow of cash within a company"
    },
    {
      "question_id": 6,
      "question": "Which of the following accounts is considered an asset?",
      "options": [
        "Accounts Payable",
        "Accounts Receivable",
        "Capital Stock",
        "Retained Earnings"
      ],
      "correct_answer": "Accounts Receivable"
    },
    {
      "question_id": 7,
      "question": "What is depreciation?",
      "options": [
        "The process of writing off an asset’s value over time",
        "The process of selling a company asset",
        "The process of auditing a company’s assets",
        "The process of increasing an asset’s value"
      ],
      "correct_answer": "The process of writing off an asset’s value over time"
    },
    {
      "question_id": 8,
      "question": "Which of the following is an example of an operating expense?",
      "options": [
        "Interest expense",
        "Rent expense",
        "Income tax expense",
        "Sale of assets"
      ],
      "correct_answer": "Rent expense"
    },
    {
      "question_id": 9,
      "question": "What is accrual accounting?",
      "options": [
        "Recording revenue when it is received",
        "Recording expenses when they are paid",
        "Recording transactions when they occur, regardless of cash movement",
        "Recording income only when cash is collected"
      ],
      "correct_answer": "Recording transactions when they occur, regardless of cash movement"
    },
    {
      "question_id": 10,
      "question": "Which of the following is a characteristic of a sole proprietorship?",
      "options": [
        "Limited liability for owners",
        "Income is taxed twice",
        "Owner has full control over business decisions",
        "Ownership is transferred easily"
      ],
      "correct_answer": "Owner has full control over business decisions"
    },
    {
      "question_id": 11,
      "question": "What is a trial balance used for?",
      "options": [
        "To verify that all accounts have been correctly calculated",
        "To determine a company’s profitability",
        "To prepare the balance sheet",
        "To prepare tax filings"
      ],
      "correct_answer": "To verify that all accounts have been correctly calculated"
    },
    {
      "question_id": 12,
      "question": "Which account is increased by a debit?",
      "options": [
        "Revenue",
        "Liabilities",
        "Assets",
        "Equity"
      ],
      "correct_answer": "Assets"
    },
    {
      "question_id": 13,
      "question": "Which of the following financial statements shows a company’s profitability over a period?",
      "options": [
        "Balance Sheet",
        "Income Statement",
        "Cash Flow Statement",
        "Statement of Changes in Equity"
      ],
      "correct_answer": "Income Statement"
    },
    {
      "question_id": 14,
      "question": "What is the main purpose of an income statement?",
      "options": [
        "To report a company’s financial position",
        "To show cash inflows and outflows",
        "To summarize revenues and expenses over a period",
        "To list company assets and liabilities"
      ],
      "correct_answer": "To summarize revenues and expenses over a period"
    },
    {
      "question_id": 15,
      "question": "Which of the following is considered a long-term liability?",
      "options": [
        "Accounts Payable",
        "Loans Payable",
        "Income Taxes Payable",
        "Dividends Payable"
      ],
      "correct_answer": "Loans Payable"
    }
  ]
}
};
let studentAccounts = {
  CSE: [{ username: "demo", password: "1234" }], Management: [], Accounting: [ {username: "demo", password: "1234" }], Economics: []
};
let questions = [], current = 0, userAnswers = [], flagged = [], timer, department = "";

function login() {
  department = document.getElementById('department').value;
  let version = document.getElementById('questionVersion').value;
  let u = document.getElementById('username').value;
  let p = document.getElementById('password').value;

  if (u === "admin" && p === "admin123") {
    show('adminUpload');
    document.getElementById('leftPanel').style.display = 'none';
    document.getElementById('rightPanel').style.display = 'none';
    return;
  }

  let valid = studentAccounts[department]?.some(acc => acc.username === u && acc.password === p);
  if (valid && allQuestions[department] && allQuestions[department][version]) {
    questions = allQuestions[department][version];
    userAnswers = Array(questions.length).fill(null);
    flagged = Array(questions.length).fill(false);
    show('quiz');
    document.getElementById('leftPanel').style.display = 'block';
    document.getElementById('rightPanel').style.display = 'block';
    startTimer(30 * 60);
    renderQuestion();
    renderNav();
  } else {
    alert('Invalid credentials or question set not found.');
  }
}

function renderQuestion() {
  const q = questions[current];
  let html = `<h3>Q${current+1}</h3><p>${q.q}</p>`;
  q.options.forEach((opt, i) => {
    html += `<label><input type='radio' name='q' value='${i}' ${userAnswers[current] === i ? 'checked' : ''} onchange='submitAnswer(${i})'> ${opt}</label><br>`;
  });
  document.getElementById('questionBox').innerHTML = html;
  renderNav();
}

function nextQuestion() { if (current < questions.length - 1) { current++; renderQuestion(); } }
function prevQuestion() { if (current > 0) { current--; renderQuestion(); } }
function submitAnswer(val) { userAnswers[current] = val; renderNav(); }

function toggleFlag() { flagged[current] = !flagged[current]; renderNav(); }

function renderNav() {
  let html = '';
  for (let i = 0; i < questions.length; i++) {
    let cls = '';
    if (userAnswers[i] != null) cls += 'answered ';
    if (flagged[i]) cls += 'flagged';
    html += `<span class='${cls}' onclick='goTo(${i})'>${i + 1}</span>`;
  }
  document.getElementById('questionNav').innerHTML = html;
}

function goTo(i) { current = i; renderQuestion(); }
function showSummary() {
  show('summary');
  let html = '';
  questions.forEach((q, i) => {
    html += `<p>Q${i+1}: ${userAnswers[i]!=null?'✅':'❌'} ${flagged[i]?'🚩':''}</p>`;
  });
  document.getElementById('summaryContent').innerHTML = html;
}
function backToAttempt() { show('quiz'); renderQuestion(); }
function confirmSubmit() { if (confirm("Are you sure you want to submit?")) finishQuiz(); }
function finishQuiz() {
  show('review');
  let score = 0, html = '';
  questions.forEach((q, i) => {
    let ua = userAnswers[i];
    let ca = q.answer;
    if (ua === ca) score++;
    html += `<div class='answer-review'>Q${i+1}: ${q.q}<br> Your: <span class='${ua === ca ? 'correct' : 'incorrect'}'>${q.options[ua] || 'No answer'}</span><br> Correct: <span class='correct'>${q.options[ca]}</span><br></div><hr>`;
  });
  html = `<p>You scored ${score}/${questions.length} (${Math.round(score/questions.length*100)}%)</p>` + html;
  document.getElementById('reviewContent').innerHTML = html;
}

function startTimer(secs) {
  timer = setInterval(() => {
    if (secs <= 0) { clearInterval(timer); finishQuiz(); }
    else {
      let m = Math.floor(secs / 60), s = secs % 60;
      document.getElementById('time').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
      secs--;
    }
  }, 1000);
}

function uploadQuestions() {
  let file = document.getElementById('fileInput').files[0];
  if (!file) return alert("No file selected.");
  let reader = new FileReader();
  reader.onload = (e) => {
    try {
      allQuestions = JSON.parse(e.target.result);
      alert("Questions uploaded successfully!");
    } catch {
      alert("Invalid JSON format.");
    }
  };
  reader.readAsText(file);
}

function addStudent() {
  let dept = document.getElementById('newStudentDept').value;
  let user = document.getElementById('newStudentUser').value;
  let pass = document.getElementById('newStudentPass').value;

  if (!dept || !user || !pass) {
    alert("Fill all fields.");
    return;
  }
  if (!studentAccounts[dept]) studentAccounts[dept] = [];
  if (studentAccounts[dept].some(s => s.username === user)) {
    alert("Username already exists in that department.");
    return;
  }
  studentAccounts[dept].push({ username: user, password: pass });
  alert("Student added successfully!");
  document.getElementById('newStudentUser').value = "";
  document.getElementById('newStudentPass').value = "";
}

function show(id) {
  ['login', 'quiz', 'summary', 'review', 'adminUpload'].forEach(el => {
    document.getElementById(el).style.display = 'none';
  });
  document.getElementById(id).style.display = 'block';
}
</script>
</body>
</html>
